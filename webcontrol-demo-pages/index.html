<!doctype html>
<html lang="en">
    <head>
        <script type="text/javascript">
        var width = screen.width;
        var meta = document.createElement('meta');
            meta.name = "viewport";
            
        if (width < 600) { //the device width is smaller than the min with of body
            meta.content = "width=device-width,initial-scale=" + width / 540;
            document.getElementsByTagName("head")[0].appendChild(meta);
        } else {
            meta.content = "width=device-width,initial-scale=1";
            document.getElementsByTagName("head")[0].appendChild(meta);
        }
        </script>
        
        <style>
            .slidecontainer{
                margin: auto;
                transition: color .2s ease-in-out;
            }
            
            .slidecontainer input {
                position: relative;
                width: 200px;
                margin: 0px 10px 0px 10px;
            }
            input{
                font-size: 18pt !important;
            }
            .slidecontainer button{
                  width: 60px;
                  height: 40px;
                  background: white;
                  font-size: 24px;
                  border: 1px solid lightgrey;
                  cursor: pointer;
                  -webkit-appearance: none;
                margin: 0px;
            }
            body{
                font-size: 16pt;
                font-family: sans-serif;
            }
            .start-stop{
                  width: 420px;
                  height: 40px;
                  border-radius: 20px;
                  background: white;
                  font-size: 24px;
                  border: 1px solid lightgrey;
                  cursor: pointer;
                  -webkit-appearance: none;
                  margin: 10px 10px;
            }
            .config{
                  width: 200px;
                  height: 40px;
                  border-radius: 20px;
                  background: white;
                  font-size: 24px;
                  border: 1px solid lightgrey;
                  cursor: pointer;
                  -webkit-appearance: none;
                  margin: 10px 10px;
            }
            button:hover:enabled{
                background-color: #0094e2;
                color: #fff;
            }
            .heading{
                text-align: center;
                font-size: 20pt;
                font-weight: bold;
            }
            td{
                text-align: center;
            }
            .slider-l{
                border-bottom-left-radius: 20px;
                border-top-left-radius: 20px;
            }
            .slider-r{
                border-bottom-right-radius: 20px;
                border-top-right-radius: 20px;
            }
            #container{
                width: 500px;
                margin: auto;
                text-align: center;
                padding: 20px 10px 0px 10px;
            }
            table{
                /*border: 1px solid black;*/
                margin: auto;
                padding-top: 10px;
            }
            html, body{
                margin: 0px;
                padding:0px;
                width: 100%;
                height: 100%;
                background-color: #f7f7f7;
            }
            button{
                touch-action: manipulation;
                /*transition: color .2s ease-in-out;*/
            }
            .slider{
                width: 200px;
                margin: 0px 10px;
            }
            
            /* Style the tab */
            .tab {
                margin-top: 20.667px;
                padding: 0px;
                border-radius: 0px 0px 15px 15px;
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
            }

            /* Style the buttons that are used to open the tab content */
            .tab button {
                margin: 0px;
            font-size: 16pt;
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            font-weight: bold;
            }

            /* Change background color of buttons on hover*/
            .tab button:hover {
            background-color: #ddd;
            color:#000;
            }

            /* Create an active/current tablink class */
            .tab button.active {
                background-color: #0094e2;
                color: #fff;
            }

            /* Style the tab content */
            .tabcontent {
            display: none;
            /*padding: 6px 12px;*/
            padding: 6px 0px;
            /*border: 1px solid #ccc;*/
            border-top: none;
            position: relative;
            }
            .buttonTableContainer{
                position: absolute;
                bottom: -20px;
                width: 100%;
            }
            .buttonTable{
                width: 450px;
                margin: 25px;
                margin-top: 0px;
            }
            .alignL{
                text-align: left;
            }
            hr{
                border: 1px solid #ccc;
            }
        </style>
        
    </head>
    <body>
        <div id="container">
              <div id="setup" class="tabcontent">
                <div class="slidecontainer">
                    <table>
                        
                        <tr class="heading"><td colspan="3">Start Position</td></tr>
                        <tr>
                        <td><button class="slider-l" id="slider-minus-big-1">-5</button><button class="slider-r" id="slider-minus-1">-1</button></td>
                        <td><input type="range" min="0" max="100" value="0" class="slider" id="slider-1"></td>
                            <td><button class="slider-l" id="slider-plus-1">+1</button><button class="slider-r" id="slider-plus-big-1">+5</button></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td><center><div class="slider-value" id="slider-value-1">16</div></center></td>
                        
                            <td></td>
                        </tr>
                    </table>
                </div>
                
                
                    <hr>
                
                <div class="slidecontainer">
                    <table>
                        <tr class="heading"><td colspan="3">End Position</td></tr>
                        <tr>
                        <td><button class="slider-l" id="slider-minus-big-2">-5</button><button class="slider-r" id="slider-minus-2">-1</button></td>
                        <td><input type="range" min="0" max="100" value="100" class="slider" id="slider-2"></td>
                        <td><button class="slider-l" id="slider-plus-2">+1</button><button class="slider-r" id="slider-plus-big-2">+5</button></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td><center><div class="slider-value" id="slider-value-2">16</div></center></td>
                            <td></td>
                        </tr>
                    </table>
                </div>
                
                    <hr>
                    <div class="slidecontainer">
                        <table>
                            <tr class="heading"><td colspan="3">Current Position</td></tr>
                            <tr>
                            <td><button class="slider-l" id="slider-minus-big-3" onclick="goToMinus(10)">-10</button><button class="slider-r" id="slider-minus-3" onclick="goToMinus(1)">-1</button></td>
                            <td><progress id="slider-3" value="32" max="100" class="slider"> </progress></td>
                            <td><button class="slider-l" id="slider-plus-3" onclick="goToPlus(1)">+1</button><button class="slider-r" id="slider-plus-big-3" onclick="goToPlus(10)">+10</button></td>
                            </tr>
                            <tr>
                                <td></td>
                                <td><center><div class="slider-value" id="slider-value-3">16</div></center></td>
                                <td></td>
                            </tr>
                        </table>
                    </div>
                
                    <hr>
                <table>
                    <tr>
                        <td><button class="config" id="gotostart"  onclick="goToStart()">Go to Start</button></td>
                        <td><button class="config" id="gotoend"  onclick="goToEnd()">Go to End</button></td>
                    </tr>
                    <tr>
                        <td><button class="config" id="home" onclick="home()">Home</button></td>
                        <td><button class="config" id="takephoto"  onclick="takePhoto()">Take Photo</button></td>
                    </tr>
                </table>
              </div>
              
              <div id="timelapse" class="tabcontent">
                
                <hr />
                <div class="buttonTableContainer">
                    <table>
                        <tr>
                            <td><label for="duration">Duration (s):</label></td>
                            <td><input type="number" inputmode="numeric" pattern="[0-9]*" id="duration" name="duration"></td>
                        </tr>
                        <tr>
                        <td>
                    <label for="noPics">No. Pictures:</label></td>
                        <td>
                    <input type="number" inputmode="numeric" pattern="[0-9]*" id="noPics" name="noPics"></td>
                        </tr>
                    </table>
                    <hr />
                <table class="buttonTable">
                    <tr>
                        <td colspan="2"><button class="start-stop" id="gotostart"  onclick="goToStart()">Start</button></td>
                    </tr>
                </table>
                </div>
              </div>
              
              <div id="misc" class="tabcontent">
                <table>
                    <tr class="heading">
                    <td colspan="3">Motion Type</td>
                    </tr>
                    <tr>
                        <td class="alignL"><input type="radio" name="motionType" checked="checked" value="linear" id="linear" onchange="updateAuxiliarySliders(-1)"><label for="linear">Constant</label></td>
                    <td></td>
                    <td></td>
                    </tr>
                    <tr>
                    <td class="alignL"><input type="radio" name="motionType" value="easeInOut" id="easeInOut" onchange="updateAuxiliarySliders(2)"><label for="easeInOut">Ease in/out</label></td>
                    <td class="alignL"><input type="radio" name="motionType" value="easeIn" id="easeIn" onchange="updateAuxiliarySliders(0)"><label for="easeIn">Ease in</label></td>
                    <td class="alignL"><input type="radio" name="motionType" value="easeOut" id="easeOut" onchange="updateAuxiliarySliders(1)"><label for="easeOut">Ease out</label></td>
                    </tr>
                    <tr>
                    <td class="alignL"><input type="radio" name="motionType" value="rampInOut" id="rampInOut" onchange="updateAuxiliarySliders(2)"><label for="rampInOut">Ramp in/out</label></td>
                    <td class="alignL"><input type="radio" name="motionType" value="rampIn" id="rampIn" onchange="updateAuxiliarySliders(0)"><label for="rampIn">Ramp in</label></td>
                    <td class="alignL"><input type="radio" name="motionType" value="rampOut" id="rampOut" onchange="updateAuxiliarySliders(1)"><label for="rampOut">Ramp out</label></td>
                    </tr>
                </table>
                <hr/>
                <div class="slidecontainer" id="auxiliarySliderContainer0">
                    <table>
                        
                        <tr class="heading"><td colspan="3">Auxiliary Point (in)</td></tr>
                        <tr>
                        <td><button class="slider-l" id="slider-minus-big-4">-5</button><button class="slider-r" id="slider-minus-4">-1</button></td>
                        <td><input type="range" min="0" max="100" value="20" class="slider" id="slider-4"></td>
                            <td><button class="slider-l" id="slider-plus-4">+1</button><button class="slider-r" id="slider-plus-big-4">+5</button></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td><center><div class="slider-value" id="slider-value-4">20</div></center></td>
                        
                            <td></td>
                        </tr>
                    </table>
                </div>
                <hr/>
                <div class="slidecontainer" id="auxiliarySliderContainer1">
                    <table>
                        
                        <tr class="heading"><td colspan="3">Auxiliary Point (out)</td></tr>
                        <tr>
                        <td><button class="slider-l" id="slider-minus-big-5">-5</button><button class="slider-r" id="slider-minus-5">-1</button></td>
                        <td><input type="range" min="0" max="100" value="80" class="slider" id="slider-5"></td>
                            <td><button class="slider-l" id="slider-plus-5">+1</button><button class="slider-r" id="slider-plus-big-5">+5</button></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td><center><div class="slider-value" id="slider-value-5">80</div></center></td>
                        
                            <td></td>
                        </tr>
                    </table>
                </div>
                <div class="buttonTableContainer">
                    <hr />
                <table class="buttonTable">
                    <tr>
                        <td colspan="2"><button class="start-stop" id="start" onclick="startJob()">Start</button></td>
                    </tr>
                </table>
            </div>
              </div>
              <div id="config" class="tabcontent">
                <table>
                    <tr class="heading">
                        <td colspan="2">Machine</td>
                    </tr>
                    <tr>
                        <td class="alignL"><label for="duration">Max Position:</label></td>
                        <td><input type="number" inputmode="numeric" pattern="[0-9]*" id="duration" name="duration"></td>
                    </tr>
                    <tr>
                        <td class="alignL"><label for="duration">Motor RPM:</label></td>
                        <td><input type="number" inputmode="numeric" pattern="[0-9]*" id="duration" name="duration"></td>
                    </tr>
                    <tr>
                    <td colspan="2">
                        <input type="checkbox" id="invertMotor" name="invertMotor"><label for="invertMotor">Invert Motor Direction</label></td>
                    <td>
                </td>
                    </tr>
                </table>
                <hr />
                <table>
                    <tr class="heading">
                        <td colspan="2">Photos</td>
                    </tr>
                    <tr>
                        <td class="alignL"><label for="duration">Shutter Time (ms):</label></td>
                        <td><input type="number" inputmode="numeric" pattern="[0-9]*" id="duration" name="duration"></td>
                    </tr>
                    <tr>
                        <td class="alignL"><label for="duration">Vibration Delay (ms):</label></td>
                        <td><input type="number" inputmode="numeric" pattern="[0-9]*" id="duration" name="duration"></td>
                    </tr>
                </table>
                <div class="buttonTableContainer">
                    <hr />
                <table class="buttonTable">
                    <tr>
                        <td colspan="2"><button class="start-stop" id="start" onclick="saveConfig()">Save</button></td>
                    </tr>
                </table>
            </div>
              </div>

              <div class="tab">
                <button id="setupButton" class="tablinks active" onclick="openTab('setup')">Camera Setup</button>
                <button id="timelapseButton" class="tablinks" onclick="openTab('timelapse')">Timelapse</button>
                <button id="miscButton" class="tablinks" onclick="openTab('misc')">Misc.</button>
                <button id="configButton" class="tablinks" onclick="openTab('config')">Config</button>
              </div>

            
        </div>
        <script>
            var slider = [];
            var sliderValues =[];
            var sliderC=2;
            var smallIncrement = 1;
            var bigIncrement = 5;
            
            for(var i=0;i<sliderC;++i){
                slider.push(document.getElementById("slider-"+(i+1)));
                sliderValues.push(document.getElementById("slider-value-"+(i+1)));
                
                //update values on slider input
                sliderValues[i].innerHTML = slider[i].value;
                (function(i) {
                slider[i].oninput = function(e) {
                    sliderValues[i].innerHTML = slider[i].value;
                }
                })(i);
                
                //update slider values on buttonclick
                (function(i) {
                document.getElementById("slider-minus-"+(i+1)).onclick = function(e) {
                    slider[i].value = parseFloat(slider[i].value)-smallIncrement;
                    sliderValues[i].innerHTML = slider[i].value;
                }
                })(i);
                (function(i) {
                document.getElementById("slider-minus-big-"+(i+1)).onclick = function(e) {
                    slider[i].value = parseFloat(slider[i].value)-bigIncrement;
                    sliderValues[i].innerHTML = slider[i].value;
                }
                })(i);
                (function(i) {
                document.getElementById("slider-plus-"+(i+1)).onclick = function(e) {
                    slider[i].value = parseFloat(slider[i].value) + smallIncrement;
                    sliderValues[i].innerHTML = slider[i].value;
                }
                })(i);
                (function(i) {
                document.getElementById("slider-plus-big-"+(i+1)).onclick = function(e) {
                    slider[i].value = parseFloat(slider[i].value)+bigIncrement;
                    sliderValues[i].innerHTML = slider[i].value;
                }
                })(i);
            }
            
            
            function startJob(){
                dur = document.getElementById("duration").value.toString();
                noPics = document.getElementById("noPics").value.toString();
                if(dur =="" || noPics=="" || dur =="0" || noPics=="0")
                    alert("Duration and Number of Pictures cannot be none!");
                else
                    window.location.replace("?start"+"&pos1="+slider[0].value+"&pos2="+slider[1].value+"&duration="+dur+"&nopics="+noPics)
            }
            function home(){
                dur = document.getElementById("duration").value.toString();
                noPics = document.getElementById("noPics").value.toString();
                var xhr = new XMLHttpRequest();
                xhr.open("GET", "?home"+"&pos1="+slider[0].value+"&pos2="+slider[1].value+"&duration="+dur+"&nopics="+noPics, true);
                xhr.send();
                refresh();
            }
            function goToStart(){
                dur = document.getElementById("duration").value.toString();
                noPics = document.getElementById("noPics").value.toString();
                var xhr = new XMLHttpRequest();
                xhr.open("GET","?gotopos="+slider[0].value+"&pos1="+slider[0].value+"&pos2="+slider[1].value+"&duration="+dur+"&nopics="+noPics, true);
                xhr.send();
                refresh();
            }
            function goToEnd(){
                dur = document.getElementById("duration").value.toString();
                noPics = document.getElementById("noPics").value.toString();
                var xhr = new XMLHttpRequest();
                xhr.open("GET", "?gotopos="+slider[1].value+"&pos1="+slider[0].value+"&pos2="+slider[1].value+"&duration="+dur+"&nopics="+noPics, true);
                xhr.send();
                refresh();
            }
            function goToPlus(delta){
                dur = document.getElementById("duration").value.toString();
                noPics = document.getElementById("noPics").value.toString();
                var xhr = new XMLHttpRequest();
                xhr.open("GET", "?gotoplus="+delta+"&pos1="+slider[0].value+"&pos2="+slider[1].value+"&duration="+dur+"&nopics="+noPics, true);
                xhr.send();
                refresh();
            }
            function goToMinus(delta){
                dur = document.getElementById("duration").value.toString();
                noPics = document.getElementById("noPics").value.toString();
                var xhr = new XMLHttpRequest();
                xhr.open("GET", "?gotominus="+delta+"&pos1="+slider[0].value+"&pos2="+slider[1].value+"&duration="+dur+"&nopics="+noPics, true);
                xhr.send();
                refresh();
            }
            function takePhoto(){
                dur = document.getElementById("duration").value.toString();
                noPics = document.getElementById("noPics").value.toString();
                var xhr = new XMLHttpRequest();
                xhr.open("GET", "?takephoto&pos1="+slider[0].value+"&pos2="+slider[1].value+"&duration="+dur+"&nopics="+noPics, true);
                xhr.send();
                refresh();
            }
            
            //window.setInterval('refresh()', 1000);   
            function refresh() {
                    var xhr = new XMLHttpRequest();
                    xhr.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                            document.getElementById("slider-3").value= parseFloat(this.responseText); 
                            document.getElementById("slider-value-3").innerHTML = parseFloat(this.responseText);
                        }
                    }; 
                    xhr.open("GET", "?currentpos", true);
                    xhr.send();
            }
            refresh();


            function openTab(tabId){
                var tabIds = ["setup", "timelapse", "misc", "config"];
                var tabIdsC = 4;

                //display tabId tab
                document.getElementById(tabId).style.display = "block";
                document.getElementById(tabId + "Button").className += " active";
                //hide all tabs
                for(var i =0; i<tabIdsC; ++i){
                    if(tabIds[i]!=tabId){
                        document.getElementById(tabIds[i]).style.display = "none";
                        document.getElementById(tabIds[i] + "Button").className = document.getElementById(tabIds[i] + "Button").className.replace(" active", "");
                    }
                }
            }
            document.getElementById("setup").style.display = "block";

            function setDivHeight(){
                var tabIds = ["setup", "timelapse", "misc", "config"];
                var tabIdsC = 4;
                //adjust div heigt
                //get height of camera setup div
                //-12 for padding (6 top, 6 bottom), 1px border at bottom
                var divHeight = document.getElementById("setup").offsetHeight - 12 - 1;

                //hide all tabs
                for(var i =0; i<tabIdsC; ++i){
                    document.getElementById(tabIds[i]).style.height = divHeight + "px";
                }
            }
            setDivHeight();

            function updateAuxiliarySliders(t){
                if(t == -1){
                    disableAuxiliarySlider(0);
                    disableAuxiliarySlider(1);
                } else if(t == 0){
                    enableAuxiliarySlider(0);
                    disableAuxiliarySlider(1);
                } else if(t == 1){
                    disableAuxiliarySlider(0);
                    enableAuxiliarySlider(1);
                } else if(t == 2){
                    enableAuxiliarySlider(0);
                    enableAuxiliarySlider(1);
                }
            }
            updateAuxiliarySliders(-1);
            function disableAuxiliarySlider(t){
                if(t ==0){
                    document.getElementById("slider-4").setAttribute('disabled', true);
                    document.getElementById("slider-minus-big-4").setAttribute('disabled', true);
                    document.getElementById("slider-minus-4").setAttribute('disabled', true);
                    document.getElementById("slider-plus-big-4").setAttribute('disabled', true);
                    document.getElementById("slider-plus-4").setAttribute('disabled', true);
                    document.getElementById("auxiliarySliderContainer0").style.color = "rgba(16, 16, 16, 0.3)";
                } else if(t ==1){
                    document.getElementById("slider-5").setAttribute('disabled', true);
                    document.getElementById("slider-minus-big-5").setAttribute('disabled', true);
                    document.getElementById("slider-minus-5").setAttribute('disabled', true);
                    document.getElementById("slider-plus-big-5").setAttribute('disabled', true);
                    document.getElementById("slider-plus-5").setAttribute('disabled', true);
                    document.getElementById("auxiliarySliderContainer1").style.color = "rgba(16, 16, 16, 0.3)";
                }
            }
            function enableAuxiliarySlider(t){
                if(t ==0){
                    document.getElementById("slider-4").removeAttribute('disabled');
                    document.getElementById("slider-minus-big-4").removeAttribute('disabled');
                    document.getElementById("slider-minus-4").removeAttribute('disabled');
                    document.getElementById("slider-plus-big-4").removeAttribute('disabled');
                    document.getElementById("slider-plus-4").removeAttribute('disabled');
                    document.getElementById("auxiliarySliderContainer0").style.color = "#000";
                } else if(t ==1){
                    document.getElementById("slider-5").removeAttribute('disabled');
                    document.getElementById("slider-minus-big-5").removeAttribute('disabled');
                    document.getElementById("slider-minus-5").removeAttribute('disabled');
                    document.getElementById("slider-plus-big-5").removeAttribute('disabled');
                    document.getElementById("slider-plus-5").removeAttribute('disabled');
                    document.getElementById("auxiliarySliderContainer1").style.color = "#000";
                }
            }
        </script>
    </body>
</html>
